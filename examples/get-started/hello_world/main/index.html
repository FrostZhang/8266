<!DOCTYPE html>
<html lang='ch'>
<link rel='icon' href='data:;base64,='>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
    <title>AsherLink</title>
    <style>
        button {
            min-width: 180px;
        }

        td {
            min-width: 75px;
        }

        table {
            padding-left: 15%;
        }
    </style>

<body id="body" onload="load()">
    <h1>Asher-Link</h1>
    <h3>控制开关</h3>
    <form id="gpio" method="post">
        <table>
            <tr>
                <td>Gpio4:</td>
                <td>
                    <button id="open4" name="open4" type="submit" value="1">开</button>
                </td>
            </tr>
            <tr>
                <td>Gpio12:</td>
                <td>
                    <button id="open12" name="open12" type="submit" value="1">开</button>
                </td>
            </tr>
            <tr>
                <td>Gpio13:</td>
                <td>
                    <button id="open13" name="open13" type="submit" value="1">开</button>
                </td>
            </tr>
            <tr>
                <td>Gpio15:</td>
                <td>
                    <button id="open15" name="open15" type="submit" value="1">开</button>
                </td>
            </tr>
        </table>
    </form>
    <h3>MQTT（开发者平台）</h3>
    <form id="mqtt" method="post">
        <table>
            <tr>
                <td>MQTT ZZ:</td>
                <td>
                    <input id="mqttzz" name="mqttzz" type="Text" value="123213" ></input>
                </td>
            </tr>
            <tr>
                <td>MQTT MM:</td>
                <td>
                    <input id="mqttmm" name="mqttmm" type="password"></input>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button type="submit">更新MQTT配置</button>
                </td>
            </tr>
        </table>
    </form>
    <script type='text/javascript'>
        var xmlhttp;
        function load() {
            xmlhttp = null;
            if (window.XMLHttpRequest) {// code for all new browsers
                xmlhttp = new XMLHttpRequest();
            }
            else if (window.ActiveXObject) {// code for IE5 and IE6
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            if (xmlhttp == null) {
                alert("浏览器版本过低，无法读取数据");
            }
            test();
        }
        function getXMLDoc(url, res) {
            xmlhttp.onreadystatechange = state_Change;
            xmlhttp.open("GET", url, true);
            // if (!xmlhttp.isopen) {
            //     console.log("打开失败")
            //     return;
            // }
            xmlhttp.send(null);
            function state_Change() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    if (xmlhttp.responseText != null && xmlhttp.responseText != "") {
                        console.log(xmlhttp.responseText)
                        res();
                    }
                }
            }
        }
        function test() {
            getXMLDoc("/htmlData", lodback);
            function lodback() {
                //console.log(xmlhttp.responseText)
                var str = xmlhttp.responseText;
                if (str != null && str.length > 0) {
                    var strs = str.split(',');
                    strs.forEach(s => {
                        var kv = s.split("=");
                        if (kv[0] == "open4") {
                            var o = document.getElementById("open4");
                            o.value = "0";
                            o.textContent = "关";
                        }
                        if (kv[0] == "open12") {
                            var o = document.getElementById("open12");
                            o.value = "0";
                            o.textContent = "关";
                        } if (kv[0] == "open13") {
                            var o = document.getElementById("open13");
                            o.value = "0";
                            o.textContent = "关";
                        }if (kv[0] == "open15") {
                            var o = document.getElementById("open15");
                            o.value = "0";
                            o.textContent = "关";
                        }if (kv[0] == "mqttzz") {
                            var o = document.getElementById("mqttzz");
                            o.value = kv[1];
                        }if (kv[0] == "mqttmm") {
                            var o = document.getElementById("mqttmm");
                            o.value = kv[1];
                        }
                    });

                }
            }
        }
    </script>
</body>
</head>

</html>